{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _toConsumableArray from \"@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { useFormik, FieldArray, FormikProvider } from \"formik\";\nimport * as Yup from \"yup\";\nimport { map } from \"lodash\";\nimport useApp from \"../../../../../hooks/useApp\";\nimport TagLang from \"../../../../modules/GetTagLang\";\nimport MessageValidation from \"../../../../modules/Forms/MessageValidation\";\nimport GetLanguage from \"../../../../../helper/i18n/getValueTagLang\";\nimport request from \"../../../../../helper/core_services/core/requestService\";\nimport blog from \"../../../../../helper/core_services/endpoints/blog\";\nimport { loadElement } from \"../../../../../helper/appearance/load\";\nimport { sortByAttr } from \"../../../../../helper/array/sort\";\nimport FieldPic from \"../../../../../helper/forms/elements/pic_1\";\nimport FieldVideo from \"../../../../../helper/forms/elements/video\";\nimport FieldCheck from \"../../../../../helper/forms/elements/check\";\nimport SubContentsCont from \"./SubContentsCont\";\nexport default function FormNewBlog(_ref) {\n  var idElement = _ref.idElement;\n  var router = useRouter();\n\n  var _useApp = useApp(),\n      locale = _useApp.locale;\n\n  var formik = useFormik({\n    validateOnChange: false,\n    initialValues: initialValues(),\n    validationSchema: Yup.object(validationSchema()),\n    onSubmit: function () {\n      var _onSubmit = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(formData, _ref2) {\n        var resetForm;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                resetForm = _ref2.resetForm;\n                if (!(formData !== null && formData !== void 0 && formData.id)) SendNewForm(formData, resetForm);else {\n                  SendUpdateForm(formData);\n                }\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function onSubmit(_x, _x2) {\n        return _onSubmit.apply(this, arguments);\n      }\n\n      return onSubmit;\n    }()\n  });\n  useEffect(function () {\n    if (idElement) GetData();\n  }, [idElement]);\n\n  var GetData = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var req, images, texts, contents;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return request(blog.get_blog, null, [idElement], {\n                locale: locale\n              });\n\n            case 2:\n              req = _context2.sent;\n\n              if (req != null) {\n                images = map(req.images, function (element) {\n                  element.image_check = \"up\";\n                  element.type = 1;\n                  return element;\n                });\n                texts = map(req.paragraphs, function (element) {\n                  element.type = 2;\n                  return element;\n                });\n                contents = [].concat(_toConsumableArray(images), _toConsumableArray(texts));\n                sortByAttr();\n                contents = contents.sortBy(\"order\");\n                PutData(req, contents); // this.setState({ dataGet: req });\n                // this.setState({ imageLements: order });\n              }\n\n            case 4:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function GetData() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var PutData = function PutData(info, contents) {\n    var values = {\n      id: info.id,\n      image_check: info.image == null ? \"\" : info.image,\n      image_pic_preview: info.image,\n      video: info.video,\n      title: info.title,\n      instagramLink: info.instagramLink,\n      isActive: info.isActive,\n      isPublic: info.isPublic,\n      content: info.content,\n      contents: contents\n    };\n    formik.setValues(values);\n  };\n\n  var SendNewForm = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(formData, resetForm) {\n      var req;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              Object.keys(formData).forEach(function (key) {\n                return formData[key] == null && delete formData[key];\n              });\n              loadElement(true);\n              _context3.next = 4;\n              return request(blog.post_blog, formData, null, {\n                locale: locale\n              });\n\n            case 4:\n              req = _context3.sent;\n              loadElement(false);\n              if (req != null) SaveContents(formData, req);\n\n            case 7:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function SendNewForm(_x3, _x4) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  var SaveContents = /*#__PURE__*/function () {\n    var _ref5 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee5(formData, info) {\n      var paramsDina, id, imagesRequest;\n      return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              paramsDina = {\n                content: formData.content,\n                paragraphs: []\n              };\n              id = info.id;\n\n              if (!(typeof formData.contents != \"undefined\")) {\n                _context5.next = 11;\n                break;\n              }\n\n              imagesRequest = [];\n              map(formData.contents, /*#__PURE__*/function () {\n                var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4(element, index) {\n                  var params;\n                  return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n                    while (1) {\n                      switch (_context4.prev = _context4.next) {\n                        case 0:\n                          if (typeof element.text != \"undefined\") paramsDina.paragraphs.push({\n                            order: index,\n                            text: element.text\n                          });\n\n                          if (typeof element.image != \"undefined\") {\n                            params = {\n                              order: index,\n                              image: element.image\n                            };\n                            imagesRequest.push(request(blog.post_blog_img, params, [id], {\n                              locale: locale\n                            }));\n                          }\n\n                        case 2:\n                        case \"end\":\n                          return _context4.stop();\n                      }\n                    }\n                  }, _callee4);\n                }));\n\n                return function (_x7, _x8) {\n                  return _ref6.apply(this, arguments);\n                };\n              }());\n              loadElement(true);\n              _context5.next = 8;\n              return Promise.all(imagesRequest);\n\n            case 8:\n              _context5.next = 10;\n              return request(blog.patch_n_blog, paramsDina, [id], {\n                locale: locale\n              });\n\n            case 10:\n              loadElement(false);\n\n            case 11:\n              router.push(\"/dashboard/blogs\");\n\n            case 12:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, _callee5);\n    }));\n\n    return function SaveContents(_x5, _x6) {\n      return _ref5.apply(this, arguments);\n    };\n  }();\n\n  var SendUpdateForm = /*#__PURE__*/function () {\n    var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee6(formData) {\n      var req;\n      return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n        while (1) {\n          switch (_context6.prev = _context6.next) {\n            case 0:\n              loadElement(true);\n              if (formData.video === null) delete formData.video;\n              if (typeof formData.video === \"string\") delete formData.video;\n              _context6.next = 5;\n              return request(blog.patch_blog, formData, [idElement], {\n                locale: locale\n              });\n\n            case 5:\n              req = _context6.sent;\n              loadElement(false);\n              if (req != null) UpdateContents(formData, req);\n\n            case 8:\n            case \"end\":\n              return _context6.stop();\n          }\n        }\n      }, _callee6);\n    }));\n\n    return function SendUpdateForm(_x9) {\n      return _ref7.apply(this, arguments);\n    };\n  }();\n\n  var UpdateContents = /*#__PURE__*/function () {\n    var _ref8 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee8(formData, info) {\n      var deleteImage, paramsDina, id, imagesRequest;\n      return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              deleteImage = [];\n              map(info.images, function (image) {\n                var find = formData.contents.find(function (obj) {\n                  return obj.id == image.id;\n                });\n\n                if (find === undefined) {\n                  deleteImage.push(request(blog.delete_blog_img, {}, [idElement, image.id], {\n                    locale: locale\n                  }));\n                }\n              });\n              _context8.next = 4;\n              return Promise.all(deleteImage);\n\n            case 4:\n              paramsDina = {\n                content: formData.content,\n                paragraphs: []\n              };\n              id = idElement;\n\n              if (!(formData !== null && formData !== void 0 && formData.contents)) {\n                _context8.next = 17;\n                break;\n              }\n\n              imagesRequest = [];\n              map(formData.contents, /*#__PURE__*/function () {\n                var _ref9 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee7(element, index) {\n                  var params;\n                  return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n                    while (1) {\n                      switch (_context7.prev = _context7.next) {\n                        case 0:\n                          if (element.type === 2) paramsDina.paragraphs.push({\n                            order: index,\n                            text: element.text\n                          });\n\n                          if (element.type === 1) {\n                            if (element !== null && element !== void 0 && element.id) {\n                              params = {\n                                order: index\n                              };\n                              if (typeof value == \"string\") params[\"image\"] = element.image;\n                              imagesRequest.push(request(blog.patch_blog_img, params, [id, element.id], {\n                                locale: locale\n                              }));\n                            } else {\n                              params = {\n                                order: index,\n                                image: element.image\n                              };\n                              imagesRequest.push(request(blog.post_blog_img, params, [id], {\n                                locale: locale\n                              }));\n                            }\n                          }\n\n                        case 2:\n                        case \"end\":\n                          return _context7.stop();\n                      }\n                    }\n                  }, _callee7);\n                }));\n\n                return function (_x12, _x13) {\n                  return _ref9.apply(this, arguments);\n                };\n              }());\n              loadElement(true);\n              _context8.next = 12;\n              return Promise.all(deleteImage);\n\n            case 12:\n              _context8.next = 14;\n              return Promise.all(imagesRequest);\n\n            case 14:\n              _context8.next = 16;\n              return request(blog.patch_n_blog, paramsDina, [id], {\n                locale: locale\n              });\n\n            case 16:\n              loadElement(false);\n\n            case 17:\n              router.push(\"/dashboard/blogs\");\n\n            case 18:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee8);\n    }));\n\n    return function UpdateContents(_x10, _x11) {\n      return _ref8.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsx(\"form\", {\n    onSubmit: formik.handleSubmit,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: \"row\",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-5\",\n        children: [/*#__PURE__*/_jsx(FieldPic, {\n          formik: formik,\n          name: \"image\"\n        }), /*#__PURE__*/_jsx(FieldVideo, {\n          formik: formik,\n          name: \"video\"\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-7\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"sty-cont-input-2\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-tag\",\n            children: /*#__PURE__*/_jsx(TagLang, {\n              group: \"input\",\n              tag: \"title\"\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"sty-input\",\n            children: [/*#__PURE__*/_jsx(\"input\", {\n              name: \"title\",\n              type: \"text\",\n              value: formik.values.title,\n              onChange: formik.handleChange\n            }), /*#__PURE__*/_jsx(MessageValidation, {\n              error: formik.errors.title\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"sty-cont-input-2\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-tag\",\n            children: /*#__PURE__*/_jsx(TagLang, {\n              group: \"input\",\n              tag: \"instagram\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-input\",\n            children: /*#__PURE__*/_jsx(\"input\", {\n              name: \"instagramLink\",\n              value: formik.values.instagramLink,\n              onChange: formik.handleChange,\n              type: \"text\"\n            })\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"col-6\",\n            children: /*#__PURE__*/_jsx(FieldCheck, {\n              formik: formik,\n              name: \"isActive\",\n              tag: GetLanguage(\"input\", \"active\")\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-6\",\n            children: /*#__PURE__*/_jsx(FieldCheck, {\n              formik: formik,\n              name: \"isPublic\",\n              tag: GetLanguage(\"input\", \"public\")\n            })\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"sty-cont-input-2\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-tag\",\n            children: /*#__PURE__*/_jsx(TagLang, {\n              group: \"input\",\n              tag: \"text\"\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"sty-input\",\n            children: [/*#__PURE__*/_jsx(\"textarea\", {\n              name: \"content\",\n              value: formik.values.content,\n              onChange: formik.handleChange\n            }), /*#__PURE__*/_jsx(MessageValidation, {\n              error: formik.errors.content\n            })]\n          })]\n        }), /*#__PURE__*/_jsx(\"hr\", {}), /*#__PURE__*/_jsx(FormikProvider, {\n          value: formik,\n          children: /*#__PURE__*/_jsx(FieldArray, {\n            name: \"contents\",\n            render: function render(arrayHelpers) {\n              return /*#__PURE__*/_jsx(SubContentsCont, {\n                formik: formik,\n                arrayHelpers: arrayHelpers,\n                father: \"contents\"\n              });\n            }\n          })\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"col-12 text-center sty-magin-b-1\",\n        children: /*#__PURE__*/_jsxs(\"button\", {\n          className: \"sty-button-dash-1\",\n          type: \"submit\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-icon\",\n            children: /*#__PURE__*/_jsx(\"img\", {\n              src: \"/static/img/favicons/app/save_w.svg\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-tag\",\n            children: /*#__PURE__*/_jsx(TagLang, {\n              group: \"button\",\n              tag: \"save\"\n            })\n          })]\n        })\n      })]\n    })\n  });\n}\n\nfunction initialValues() {\n  return {\n    image_check: \"\",\n    title: \"\",\n    instagramLink: \"\",\n    isActive: false,\n    isPublic: false,\n    content: \"\",\n    contents: []\n  };\n}\n\nfunction validationSchema() {\n  return {\n    image_check: Yup.string().required(\"required\"),\n    title: Yup.string().required(\"required\"),\n    content: Yup.string().required(\"required\"),\n    contents: Yup.array().of(Yup.object().shape({\n      // image_check: Yup.string().required(\"required\"),\n      // text: Yup.string().required(\"required\"),\n      image_check: Yup.string().ensure().when(\"text\", {\n        is: undefined,\n        then: Yup.string().required(\"required\")\n      })\n    })) // .required(\"Must have friends\")\n    // .min(3, \"Minimum of 3 friends\"),\n\n  };\n}","map":null,"metadata":{},"sourceType":"module"}