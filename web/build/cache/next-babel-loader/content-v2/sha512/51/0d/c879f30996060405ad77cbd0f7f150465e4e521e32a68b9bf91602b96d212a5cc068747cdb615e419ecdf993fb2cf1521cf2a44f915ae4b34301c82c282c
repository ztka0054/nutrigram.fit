{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React, { useState, useMemo } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { useStripe, useElements, CardNumberElement, CardCvcElement, CardExpiryElement } from \"@stripe/react-stripe-js\";\nimport useApp from \"../../../../../../hooks/useApp\";\nimport TagLang from \"../../../../../modules/GetTagLang\";\nimport request from \"../../../../../../helper/core_services/core/requestService\";\nimport subscription from \"../../../../../../helper/core_services/endpoints/subscription\";\nimport GetLanguage from \"../../../../../../helper/i18n/getValueTagLang\";\nimport { loadElement } from \"../../../../../../helper/appearance/load\";\nimport { message_1 } from \"../../../../../../helper/appearance/messages\";\nvar cardVisa = \"/static/img/favicons/card/visa.svg\";\nvar cardMaster = \"/static/img/favicons/card/master.svg\";\nvar cardAmerica = \"/static/img/favicons/card/america.svg\";\nexport default function FormStripe() {\n  var stripe = useStripe();\n  var router = useRouter();\n  var elements = useElements();\n  var options = useOptions();\n\n  var _useApp = useApp(),\n      locale = _useApp.locale,\n      objectsSignUp = _useApp.objectsSignUp;\n\n  var _useState = useState(null),\n      messageError = _useState[0],\n      setMessageError = _useState[1];\n\n  var _useState2 = useState(null),\n      brandCard = _useState2[0],\n      setBrandCard = _useState2[1];\n\n  var PutBrandCard = function PutBrandCard(e) {\n    if (e.elementType == \"cardNumber\") switch (e.brand) {\n      case \"visa\":\n        setBrandCard(1);\n        break;\n\n      case \"mastercard\":\n        setBrandCard(2);\n        break;\n\n      case \"amex\":\n        setBrandCard(3);\n        break;\n\n      default:\n        setBrandCard(0);\n        break;\n    }\n    if (typeof e.error != \"undefined\") setMessageError(e.error.code);else setMessageError(null);\n  };\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var payload;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              event.preventDefault();\n              loadElement(true);\n\n              if (!(!stripe || !elements)) {\n                _context.next = 5;\n                break;\n              }\n\n              // Stripe.js has not loaded yet. Make sure to disable\n              // form submission until Stripe.js has loaded.\n              loadElement(false);\n              return _context.abrupt(\"return\");\n\n            case 5:\n              _context.next = 7;\n              return stripe.createPaymentMethod({\n                type: \"card\",\n                card: elements.getElement(CardNumberElement)\n              });\n\n            case 7:\n              payload = _context.sent;\n              PayElement(payload);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var PayElement = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(payload) {\n      var params, req, reqPatch;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!(typeof payload.paymentMethod != \"undefined\")) {\n                _context2.next = 18;\n                break;\n              }\n\n              params = {\n                paymentMethodId: payload.paymentMethod.id,\n                price: objectsSignUp.selectedSubscritpion.id //invoiceId: moment().format('HH:mm:ss/DD/MM/YYYY')\n\n              };\n              loadElement(true);\n              _context2.next = 5;\n              return request(subscription.post_subscription, params, null, locale, true, false);\n\n            case 5:\n              req = _context2.sent;\n              loadElement(false);\n\n              if (!(req != null)) {\n                _context2.next = 12;\n                break;\n              }\n\n              message_1(GetLanguage(\"validation\", \"pay_message_1\"));\n              if (!(req !== null && req !== void 0 && req.code)) router.push(\"/dashboard/profile\");\n              _context2.next = 18;\n              break;\n\n            case 12:\n              loadElement(true);\n              _context2.next = 15;\n              return request(subscription.patch_subscription, params, null, {\n                locale: locale\n              });\n\n            case 15:\n              reqPatch = _context2.sent;\n              loadElement(false);\n\n              if (reqPatch != null) {\n                message_1(GetLanguage(\"validation\", \"pay_message_1\"));\n                if (!(req !== null && req !== void 0 && req.code)) router.push(\"/dashboard/profile\");\n              }\n\n            case 18:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function PayElement(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return /*#__PURE__*/_jsxs(\"form\", {\n    onSubmit: function onSubmit(e) {\n      return handleSubmit(e);\n    },\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \"row\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"col-12\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"sty-cont-input-2\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-tag\",\n            children: /*#__PURE__*/_jsx(TagLang, {\n              group: \"input\",\n              tag: \"cardNumber\"\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"sty-input\",\n            children: [/*#__PURE__*/_jsx(CardNumberElement, {\n              className: \"sty-input-card\",\n              options: options,\n              onReady: function onReady() {\n                console.log(\"CardNumberElement [ready]\");\n              },\n              onChange: function onChange(event) {\n                console.log(\"CardNumberElement [change]\", event);\n                PutBrandCard(event);\n              },\n              onBlur: function onBlur() {\n                console.log(\"CardNumberElement [blur]\");\n              },\n              onFocus: function onFocus() {\n                console.log(\"CardNumberElement [focus]\");\n              }\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"sty-brand\",\n              children: [brandCard == 0 && /*#__PURE__*/_jsx(_Fragment, {}), brandCard == 1 && /*#__PURE__*/_jsx(\"div\", {\n                className: \"sty-cont-icon\",\n                children: /*#__PURE__*/_jsx(\"img\", {\n                  src: cardVisa\n                })\n              }), brandCard == 2 && /*#__PURE__*/_jsx(\"div\", {\n                className: \"sty-cont-icon\",\n                children: /*#__PURE__*/_jsx(\"img\", {\n                  src: cardMaster\n                })\n              }), brandCard == 3 && /*#__PURE__*/_jsx(\"div\", {\n                className: \"sty-cont-icon\",\n                children: /*#__PURE__*/_jsx(\"img\", {\n                  src: cardAmerica\n                })\n              })]\n            })]\n          })]\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"col-6\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"sty-cont-input-2\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-tag\",\n            children: /*#__PURE__*/_jsx(TagLang, {\n              group: \"input\",\n              tag: \"expirationDate\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-input\",\n            children: /*#__PURE__*/_jsx(CardExpiryElement, {\n              className: \"sty-input-card\",\n              options: options,\n              onReady: function onReady() {\n                console.log(\"CardNumberElement [ready]\");\n              },\n              onChange: function onChange(event) {\n                console.log(\"CardNumberElement [change]\", event);\n              },\n              onBlur: function onBlur() {\n                console.log(\"CardNumberElement [blur]\");\n              },\n              onFocus: function onFocus() {\n                console.log(\"CardNumberElement [focus]\");\n              }\n            })\n          })]\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"col-6\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"sty-cont-input-2\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-tag\",\n            children: /*#__PURE__*/_jsx(TagLang, {\n              group: \"input\",\n              tag: \"cvc\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-input\",\n            children: /*#__PURE__*/_jsx(CardCvcElement, {\n              className: \"sty-input-card\",\n              options: options,\n              onReady: function onReady() {\n                console.log(\"CardNumberElement [ready]\");\n              },\n              onChange: function onChange(event) {\n                console.log(\"CardNumberElement [change]\", event);\n              },\n              onBlur: function onBlur() {\n                console.log(\"CardNumberElement [blur]\");\n              },\n              onFocus: function onFocus() {\n                console.log(\"CardNumberElement [focus]\");\n              }\n            })\n          })]\n        })\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"col-12 sty-card-message\",\n      children: messageError && /*#__PURE__*/_jsx(\"div\", {\n        className: \"sty-mesage text-center\",\n        children: GetLanguage(\"validation\", messageError)\n      })\n    }), /*#__PURE__*/_jsx(\"button\", {\n      className: \"sty-button-dash-1 color_3 fix-24\",\n      type: \"submit\",\n      disabled: !stripe,\n      children: /*#__PURE__*/_jsx(TagLang, {\n        group: \"button\",\n        tag: \"pay\"\n      })\n    })]\n  });\n}\n\nvar useOptions = function useOptions() {\n  var options = useMemo(function () {\n    return {\n      style: {\n        base: {\n          fontSize: \"20.25px\",\n          color: \"#424770\",\n          letterSpacing: \"0.025em\",\n          fontFamily: \"Roboto, monospace\",\n          \"::placeholder\": {\n            color: \"#aab7c4\"\n          }\n        },\n        invalid: {\n          color: \"#9e2146\"\n        }\n      }\n    };\n  });\n  return options;\n};","map":null,"metadata":{},"sourceType":"module"}