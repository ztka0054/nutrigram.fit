{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect } from \"react\";\nimport { useRouter } from \"next/router\";\nimport { map, size, differenceBy } from \"lodash\";\nimport { useFormik, FieldArray, FormikProvider } from \"formik\";\nimport * as Yup from \"yup\";\nimport TagLang from \"../../../../modules/GetTagLang\";\nimport SelectLanguage from \"../../../../components/SelectLanguage\";\nimport InputText from \"../../../../components/Inputs/InputTypeForm_1/InputTextForm_1\";\nimport InputNumber from \"../../../../components/Inputs/InputTypeForm_1/InputNumber_1\";\nimport InputSelect from \"../../../../components/Inputs/InputTypeForm_1/InputSelectForm_1\";\nimport GetLanguage from \"../../../../../helper/i18n/getValueTagLang\";\nimport request from \"../../../../../helper/core_services/core/requestService\";\nimport apiFoods from \"../../../../../helper/core_services/endpoints/foods\";\nimport { loadElement } from \"../../../../../helper/appearance/load\";\nimport ScrollError from \"../../../../../helper/scroll/ScrollError\";\nimport PortionElementForm from \"./PortionElementForm\";\nconst icon_title = \"/static/img/favicons/app/icon_nu_1.png\";\nexport default function NewRecipe({\n  dataFood = null\n}) {\n  var _formik$errors;\n\n  const router = useRouter();\n  const {\n    0: statusLanguage,\n    1: setStatusLanguage\n  } = useState(1);\n  const {\n    0: catalogueCategories,\n    1: setCatalogueCategories\n  } = useState([]);\n  const {\n    0: cataloguePortionsInfo,\n    1: setCataloguePortionsInfo\n  } = useState([]);\n  const formik = useFormik({\n    validateOnChange: false,\n    initialValues: initialValues(),\n    validationSchema: Yup.object(validationSchema()),\n    onSubmit: async (formData, {\n      resetForm\n    }) => {\n      if (formData.fiber == \"\") delete formData.fiber;\n      if (formData.vitaminA == \"\") delete formData.vitaminA;\n      if (formData.ascorbicAcid == \"\") delete formData.ascorbicAcid;\n      if (formData.folicAcid == \"\") delete formData.folicAcid;\n      if (formData.hemIron == \"\") delete formData.hemIron;\n      if (formData.nonHemIron == \"\") delete formData.nonHemIron;\n      if (formData.potassium == \"\") delete formData.potassium;\n      if (formData.glycemicIndex == \"\") delete formData.glycemicIndex;\n      if (formData.glycemicLoad == \"\") delete formData.glycemicLoad;\n      if (formData.sugarByEquivalent == \"\") delete formData.sugarByEquivalent;\n      if (formData.calcium == \"\") delete formData.calcium;\n      if (formData.sodium == \"\") delete formData.sodium;\n      if (formData.selenium == \"\") delete formData.selenium;\n      if (formData.phosphorus == \"\") delete formData.phosphorus;\n      if (formData.cholesterol == \"\") delete formData.cholesterol;\n      if (formData.saturatedFattyAcids == \"\") delete formData.saturatedFattyAcids;\n      if (formData.monounsaturatedFattyAcids == \"\") delete formData.monounsaturatedFattyAcids;\n      if (formData.polyunsaturatedFattyAcids == \"\") delete formData.polyunsaturatedFattyAcids;\n      if (formData.ethanol == \"\") delete formData.ethanol;\n      loadElement(true);\n      if (!(formData !== null && formData !== void 0 && formData.id)) CreateFood(formData);\n      if (formData !== null && formData !== void 0 && formData.id) UpdateFood(formData);\n      loadElement(false);\n    }\n  });\n  useEffect(() => {\n    if (dataFood != null) LoadData();\n  }, [dataFood]);\n\n  const LoadData = () => {\n    var _newData$names, _newData$names2;\n\n    let newData = _objectSpread({}, dataFood);\n\n    newData.name_es = newData === null || newData === void 0 ? void 0 : (_newData$names = newData.names) === null || _newData$names === void 0 ? void 0 : _newData$names.es;\n    newData.name_en = newData === null || newData === void 0 ? void 0 : (_newData$names2 = newData.names) === null || _newData$names2 === void 0 ? void 0 : _newData$names2[\"en-us\"];\n    newData.portions = map(dataFood.portions, (portion, index) => {\n      let defaultPortion = false;\n\n      if (portion.id == dataFood.defaultPortion) {\n        newData.loadValueCheck = index;\n        defaultPortion = true;\n      }\n\n      return _objectSpread(_objectSpread({}, portion), {}, {\n        defaultPortion\n      });\n    });\n    delete newData.name;\n    formik.setValues(newData);\n  };\n\n  const CreateFood = async formData => {\n    let newForm = _objectSpread({\n      name: {\n        \"en-us\": formData.name_en,\n        es: formData.name_es\n      }\n    }, formData);\n\n    let resultFood = await request(apiFoods.post_create_food, newForm, null, {\n      locale: router.locale\n    });\n\n    if (resultFood != null) {\n      CreatePortions(formData, resultFood);\n      router.push(`/dashboard/equivalents`);\n    }\n  };\n\n  const UpdateFood = async formData => {\n    let newForm = _objectSpread({\n      name: {\n        \"en-us\": formData.name_en,\n        es: formData.name_es\n      }\n    }, formData);\n\n    let resultFood = await request(apiFoods.patch_food, newForm, [dataFood === null || dataFood === void 0 ? void 0 : dataFood.id], {\n      locale: router.locale\n    });\n\n    if (resultFood != null) {\n      CreatePortions(formData, resultFood);\n      UpdatePortions(formData, resultFood);\n      DeletePortion(formData);\n      router.push(`/dashboard/equivalents/data/${router.query.id_category}`);\n    }\n  };\n\n  const DeletePortion = async formData => {\n    let filterId = formData.portions.filter(obj => obj === null || obj === void 0 ? void 0 : obj.id);\n    let DeleteElements = differenceBy(dataFood.portions, filterId, \"id\");\n    let arrayRequest = [];\n    map(DeleteElements, element => {\n      arrayRequest.push(request(apiFoods.del_potion, null, [element.id], {\n        locale: router.locale\n      }));\n    });\n    await Promise.all(arrayRequest);\n  };\n\n  const CreatePortions = async (formData, resultFood) => {\n    let deafultPortion = null;\n    let arrayRequest = [];\n    let filterId = formData.portions.filter(obj => !(obj !== null && obj !== void 0 && obj.id));\n    map(filterId, (element, index) => {\n      if (element.defaultPortion) {\n        deafultPortion = index;\n      }\n\n      arrayRequest.push(request(apiFoods.post_portion, _objectSpread({\n        food: resultFood.id\n      }, element), null, {\n        locale: router.locale\n      }));\n    });\n    let resultPortions = await Promise.all(arrayRequest);\n\n    let params = _objectSpread({}, resultFood);\n\n    if (deafultPortion != null) {\n      params.defaultPortion = resultPortions[deafultPortion].id;\n      await request(apiFoods.put_food, params, [resultFood.id], {\n        locale: router.locale\n      });\n    }\n  };\n\n  const UpdatePortions = async (formData, resultFood) => {\n    let deafultPortion = null;\n    let arrayRequest = [];\n    let filterId = formData.portions.filter(obj => obj === null || obj === void 0 ? void 0 : obj.id);\n    map(filterId, (element, index) => {\n      if (element.defaultPortion) {\n        deafultPortion = index;\n      }\n\n      arrayRequest.push(request(apiFoods.patch_potion, _objectSpread({\n        food: resultFood.id\n      }, element), [element.id], {\n        locale: router.locale\n      }));\n    });\n    await Promise.all(arrayRequest);\n\n    let params = _objectSpread({}, resultFood);\n\n    if (deafultPortion != null) {\n      params.defaultPortion = filterId[deafultPortion].id;\n      await request(apiFoods.put_food, params, [resultFood.id], {\n        locale: router.locale\n      });\n    }\n  };\n\n  useEffect(() => {\n    if (router !== null && router !== void 0 && router.locale) {\n      GetCatalogueCategories();\n      GetTypePortionInfo();\n    }\n  }, [router.locale]);\n\n  const GetCatalogueCategories = async () => {\n    let result = await request(apiFoods.get_food_categories, null, null, {\n      locale: router.locale\n    });\n\n    if (result != null) {\n      setCatalogueCategories(result.result);\n    }\n  };\n\n  const GetTypePortionInfo = async () => {\n    let result = await request(apiFoods.get_portions_info, null, null, {\n      locale: router.locale\n    });\n\n    if (result != null) {\n      let resultNew = map(result.result, element => {\n        let name = \"\";\n        if (router.locale == \"es\") name = element.name[\"es\"];\n        if (router.locale == \"en\") name = element.name[\"en-us\"];\n        element.name = name;\n        return element;\n      });\n      setCataloguePortionsInfo(resultNew);\n    }\n  };\n\n  const ClickSend = () => {\n    ScrollError();\n  };\n\n  return /*#__PURE__*/_jsx(\"form\", {\n    onSubmit: formik.handleSubmit,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: \"row\",\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-6\",\n        children: [/*#__PURE__*/_jsx(SelectLanguage, {\n          formik: formik,\n          statusLanguage: statusLanguage,\n          setStatusLanguage: setStatusLanguage,\n          error: formik === null || formik === void 0 ? void 0 : (_formik$errors = formik.errors) === null || _formik$errors === void 0 ? void 0 : _formik$errors.language,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"sty-cont-input-2\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"sty-tag\",\n              children: [\"* \", /*#__PURE__*/_jsx(TagLang, {\n                group: \"input\",\n                tag: \"name\"\n              })]\n            }), statusLanguage == 1 && /*#__PURE__*/_jsx(\"div\", {\n              className: \"sty-input\",\n              children: /*#__PURE__*/_jsx(\"input\", {\n                name: `name_es`,\n                type: \"text\",\n                value: formik.values.name_es,\n                onChange: formik.handleChange\n              })\n            }), statusLanguage == 2 && /*#__PURE__*/_jsx(\"div\", {\n              className: \"sty-input\",\n              children: /*#__PURE__*/_jsx(\"input\", {\n                name: `name_en`,\n                type: \"text\",\n                value: formik.values.name_en,\n                onChange: formik.handleChange\n              })\n            })]\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"margin-top-2\",\n          children: /*#__PURE__*/_jsx(InputSelect, {\n            formik: formik,\n            title: \"category\",\n            name: \"category\",\n            value: formik.values.category,\n            error: formik.errors.category,\n            elements: catalogueCategories,\n            required: true\n          })\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"weight\",\n          name: \"weight\",\n          value: formik.values.weight,\n          error: formik.errors.weight,\n          required: true\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"grossWeight\",\n          name: \"grossWeight\",\n          value: formik.values.grossWeight,\n          error: formik.errors.grossWeight,\n          required: true\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"calories\",\n          name: \"calories\",\n          value: formik.values.calories,\n          error: formik.errors.calories,\n          required: true\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"protein\",\n          name: \"protein\",\n          value: formik.values.protein,\n          error: formik.errors.protein,\n          required: true\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"lipids\",\n          name: \"lipids\",\n          value: formik.values.lipids,\n          error: formik.errors.lipids,\n          required: true\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"carbohydrates\",\n          name: \"carbohydrates\",\n          value: formik.values.carbohydrates,\n          error: formik.errors.carbohydrates,\n          required: true\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"fiber\",\n          name: \"fiber\",\n          value: formik.values.fiber,\n          error: formik.errors.fiber\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"vitaminA\",\n          name: \"vitaminA\",\n          value: formik.values.vitaminA,\n          error: formik.errors.vitaminA\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"ascorbicAcid\",\n          name: \"ascorbicAcid\",\n          value: formik.values.ascorbicAcid,\n          error: formik.errors.ascorbicAcid\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"folicAcid\",\n          name: \"folicAcid\",\n          value: formik.values.folicAcid,\n          error: formik.errors.folicAcid\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"hemIron\",\n          name: \"hemIron\",\n          value: formik.values.hemIron,\n          error: formik.errors.hemIron\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"nonHemIron\",\n          name: \"nonHemIron\",\n          value: formik.values.nonHemIron,\n          error: formik.errors.nonHemIron\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"potassium\",\n          name: \"potassium\",\n          value: formik.values.potassium,\n          error: formik.errors.potassium\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"glycemicIndex\",\n          name: \"glycemicIndex\",\n          value: formik.values.glycemicIndex,\n          error: formik.errors.glycemicIndex\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"glycemicLoad\",\n          name: \"glycemicLoad\",\n          value: formik.values.glycemicLoad,\n          error: formik.errors.glycemicLoad\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"sugarByEquivalent\",\n          name: \"sugarByEquivalent\",\n          value: formik.values.sugarByEquivalent,\n          error: formik.errors.sugarByEquivalent\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"calcium\",\n          name: \"calcium\",\n          value: formik.values.calcium,\n          error: formik.errors.calcium\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"sodium\",\n          name: \"sodium\",\n          value: formik.values.sodium,\n          error: formik.errors.sodium\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"selenium\",\n          name: \"selenium\",\n          value: formik.values.selenium,\n          error: formik.errors.selenium\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"phosphorus\",\n          name: \"phosphorus\",\n          value: formik.values.phosphorus,\n          error: formik.errors.phosphorus\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"cholesterol\",\n          name: \"cholesterol\",\n          value: formik.values.cholesterol,\n          error: formik.errors.cholesterol\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"saturatedFattyAcids\",\n          name: \"saturatedFattyAcids\",\n          value: formik.values.saturatedFattyAcids,\n          error: formik.errors.saturatedFattyAcids\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"monounsaturatedFattyAcids\",\n          name: \"monounsaturatedFattyAcids\",\n          value: formik.values.monounsaturatedFattyAcids,\n          error: formik.errors.monounsaturatedFattyAcids\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"polyunsaturatedFattyAcids\",\n          name: \"polyunsaturatedFattyAcids\",\n          value: formik.values.polyunsaturatedFattyAcids,\n          error: formik.errors.polyunsaturatedFattyAcids\n        }), /*#__PURE__*/_jsx(InputNumber, {\n          formik: formik,\n          title: \"ethanol\",\n          name: \"ethanol\",\n          value: formik.values.ethanol,\n          error: formik.errors.ethanol\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-6\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"sty-title-secction-1\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"text\",\n            children: /*#__PURE__*/_jsx(TagLang, {\n              group: \"input\",\n              tag: \"portions\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"icon\",\n            children: /*#__PURE__*/_jsx(\"img\", {\n              src: icon_title\n            })\n          })]\n        }), /*#__PURE__*/_jsx(FormikProvider, {\n          value: formik,\n          children: /*#__PURE__*/_jsx(FieldArray, {\n            name: \"portions\",\n            render: arrayHelpers => /*#__PURE__*/_jsx(PortionElementForm, {\n              formik: formik,\n              arrayHelpers: arrayHelpers,\n              father: \"portions\",\n              cataloguePortionsInfo: cataloguePortionsInfo\n            })\n          })\n        })]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"col-12 text-center sty-magin-b-1\",\n        children: /*#__PURE__*/_jsxs(\"button\", {\n          className: \"sty-button-dash-1\",\n          type: \"submit\",\n          onClick: () => ClickSend(),\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-icon\",\n            children: /*#__PURE__*/_jsx(\"img\", {\n              src: \"/static/img/favicons/app/save_w.svg\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"sty-tag\",\n            children: /*#__PURE__*/_jsx(TagLang, {\n              group: \"button\",\n              tag: \"save\"\n            })\n          })]\n        })\n      })]\n    })\n  });\n}\n\nfunction initialValues() {\n  return {\n    name_es: \"\",\n    name_en: \"\",\n    category: \"\",\n    weight: \"\",\n    grossWeight: \"\",\n    calories: \"\",\n    protein: \"\",\n    lipids: \"\",\n    carbohydrates: \"\",\n    fiber: \"\",\n    vitaminA: \"\",\n    ascorbicAcid: \"\",\n    folicAcid: \"\",\n    hemIron: \"\",\n    nonHemIron: \"\",\n    potassium: \"\",\n    glycemicIndex: \"\",\n    glycemicLoad: \"\",\n    sugarByEquivalent: \"\",\n    calcium: \"\",\n    sodium: \"\",\n    selenium: \"\",\n    phosphorus: \"\",\n    cholesterol: \"\",\n    saturatedFattyAcids: \"\",\n    monounsaturatedFattyAcids: \"\",\n    polyunsaturatedFattyAcids: \"\",\n    ethanol: \"\"\n  };\n}\n\nfunction validationSchema() {\n  return {\n    // language: Yup.bool().when([\"name_es\", \"name_en\"], {\n    //     is: (name_es, name_en) =>\n    //         (!name_es && !name_en) || (!!name_es && !!name_en),\n    //     then: Yup.bool().required(\"fields_language\"),\n    //     otherwise: Yup.bool(),\n    // }),\n    language: Yup.bool().when([\"name_es\", \"name_en\"], {\n      is: (name_es, name_en) => !name_es && !name_en,\n      then: Yup.bool().required(\"fields_language\"),\n      otherwise: Yup.bool()\n    }),\n    category: Yup.string().required(\"required\"),\n    weight: Yup.string().required(\"required\"),\n    grossWeight: Yup.string().required(\"required\"),\n    calories: Yup.string().required(\"required\"),\n    protein: Yup.string().required(\"required\"),\n    lipids: Yup.string().required(\"required\"),\n    carbohydrates: Yup.string().required(\"required\"),\n    // fiber: Yup.string().required(\"required\"),\n    // vitaminA: Yup.string().required(\"required\"),\n    // ascorbicAcid: Yup.string().required(\"required\"),\n    // folicAcid: Yup.string().required(\"required\"),\n    // hemIron: Yup.string().required(\"required\"),\n    // nonHemIron: Yup.string().required(\"required\"),\n    // potassium: Yup.string().required(\"required\"),\n    // glycemicIndex: Yup.string().required(\"required\"),\n    // glycemicLoad: Yup.string().required(\"required\"),\n    // sugarByEquivalent: Yup.string().required(\"required\"),\n    // calcium: Yup.string().required(\"required\"),\n    // sodium: Yup.string().required(\"required\"),\n    // selenium: Yup.string().required(\"required\"),\n    // phosphorus: Yup.string().required(\"required\"),\n    // cholesterol: Yup.string().required(\"required\"),\n    // saturatedFattyAcids: Yup.string().required(\"required\"),\n    // monounsaturatedFattyAcids: Yup.string().required(\"required\"),\n    // polyunsaturatedFattyAcids: Yup.string().required(\"required\"),\n    // ethanol: Yup.string().required(\"required\"),\n    portions: Yup.array().of(Yup.object().shape({\n      info: Yup.string().required(\"required\"),\n      weight: Yup.string().required(\"required\"),\n      suggestedQuantity: Yup.string().required(\"required\")\n    })).min(1, \"array_ingredients\").required(\"array_ingredients\")\n  };\n}","map":null,"metadata":{},"sourceType":"module"}